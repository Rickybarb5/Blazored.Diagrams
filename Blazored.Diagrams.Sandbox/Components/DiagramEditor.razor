<MudTooltip Text="Add Node">
    <MudIconButton Icon="@Icons.Material.Filled.CropSquare" OnClick="AddNode" Variant="Variant.Filled">Add Node</MudIconButton>
</MudTooltip>
<MudTooltip Text="Add Group">
    <MudIconButton Icon="@Icons.Material.Filled.Square" OnClick="AddGroup" Variant="Variant.Filled">Add Group</MudIconButton>
</MudTooltip>

<MudTooltip Text="Save">
    <MudIconButton Icon="@Icons.Material.Filled.Save" OnClick="Save" Variant="Variant.Filled">Save Diagram</MudIconButton>
</MudTooltip>
<MudTooltip Text="Load Diagram">
    <MudIconButton Icon="@Icons.Material.Filled.Upload" OnClick="Load" Variant="Variant.Filled">Load Diagram</MudIconButton>
</MudTooltip>

@code {
    [CascadingParameter] public IDiagramService DiagramService { get; set; }
    [Inject] IDialogService DialogService { get; set; }
    [Inject] ISerializationService SerializationService { get; set; }

    [Parameter] public EventCallback<string> OnDiagramLoaded { get; set; }

    private void AddNode(MouseEventArgs arg)
    {
        var node = new NamedNode();
        DiagramService.Add.Node(node);
        node.CenterIn(DiagramService.Diagram);
    }

    private void AddGroup(MouseEventArgs obj)
    {
        var group = new Group();
        DiagramService.Add.Group(group);
        group.CenterIn(DiagramService.Diagram);
    }

    private void Save(MouseEventArgs obj)
    {
        var result = SerializationService.ToJson(DiagramService.Diagram);
        DialogService.ShowMessageBox("JSON Diagram", result);
    }

    private async Task Load(MouseEventArgs obj)
    {
        var reference = await DialogService.ShowAsync<LoadDiagramDialog>("Load", new DialogParameters() { { nameof(LoadDiagramDialog.Service), DiagramService } });
        var result = await reference.Result;

        if (!result.Canceled)
        {
            await OnDiagramLoaded.InvokeAsync((string)result.Data);
        }
    }

}